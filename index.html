<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./css/style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
  <title>Document</title>
</head>
<main>

  <div class="hamb">
    <span class="bar1"></span><span class="bar2"></span><span class="bar3"></span>
  </div>
</div>
<div class="menu">
  <ul class="lista-menu">
    <li class="item-menu" ><a  href="#home">Home</a></li>
    <li class="item-menu"><a  href="#news">News</a></li>
    <li class="item-menu"><a  href="#contact">Contact</a></li>
    <li class="item-menu"><a  href="#about">About</a></li>
  </ul>
</div>

  <div class="avisoScroll">
    <h3>Scroll down!</h3>
  </div>
  <section class="section1">

    <div class="wrapper1">

      <button class="boton" id="buttonstart"></button>
      <div class="ojo">
        <div class="forma">
          <div class="cont">
          </div>
          <div class="ball">
            <div class="iris">
              <div class="int"></div>
            </div>
          </div>
        </div>
      </div>
    </div>




  </section>
  <div class="bola"></div>

  <section class="section2"> </section>
  <section class="section3 wrapwrapper ">
    <div class="divAncho">
      <div class="amarillo"></div>
      <div class="bordeNegro"></div>
      <div class="content__text">
        <div class="blob-wrapper">
        </div>
        <div class="text--oscuridad">
          <div class="wrapperText1"></div>
          <div class="wrapperText2"></div>
          <div class="wrapperText3"></div>

          <div class="luz"></div>
        </div>
      </div>

      <div class="cosa section3b">
        <div class="cosita"></div>
        <div class="cosita1">
          <h1>hola</h1>
        </div>
        <div class="cosita"></div>

      </div>
      <div class="cosa2">
        <div class="cosita"></div>
        <div class="cosita2">
          <h1>chau</h1>
        </div>
        <div class="cosita"></div>

      </div>

    </div>
    <!--       <div><h1 class="title"> <div class="luz"></div> animaci√≥n, blob, <br> lava</h1></div>  -->

  </section>
  <section class="section4">
  </section>
  <section class="section4">

  </section>

</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/ScrollTrigger.min.js"></script>
<script>

  //MENU
  var button = document.getElementById("buttonstart");
  button.addEventListener("click", enableTimeline);



  let toggle = document.querySelector(".hamb");
  let boolmenu = false;
  let tlmenu = gsap.timeline()


  toggle.addEventListener("click", function () {
    if (boolmenu === false) {
      gsap.to(".bar1", { duration: .2, width: "45px", height: "4px", top: "48%", left: "45%", rotate: "45deg" })
      gsap.to(".bar2", { duration: .2, width: "2px", })
      gsap.to(".bar3", { duration: .2, width: "45px", height: "4px", top: "48%", left: "45%", rotate: "-45deg" })

      tlmenu.to(".lista-menu", {
        duration: .4,
        width: "100%",
        ease: "power2.in",
      });
      tlmenu.to(".lista-menu li", {
        duration: .7,
        opacity: 1,
        stagger: .1,
        ease: "power3.in",
      })
      boolmenu = true
    } else {
      gsap.to(".bar1", { duration: .2, width: "37px", height: "4px", top: "30%", left: "50%", rotate: "0deg" })
      gsap.to(".bar2", { duration: .2, width: "37px", height: "4px", top: "50%", left: "50%", opacity: 1 })
      gsap.to(".bar3", { duration: .2, width: "37px", height: "4px", top: "70%", left: "50%", rotate: "0deg" })
      tlmenu.to(".lista-menu li", {
        duration: .7,
        opacity: 0,
        stagger: .1,
        ease: "power3.out",
      })
      tlmenu.to(".lista-menu", {
        duration: .5,
        width: 0,
        ease: "power2.out",
      });
   
      boolmenu = false
    }
  })

  const showAnimli = gsap.from('.hamb', {
    yPercent: -180,
    stagger: 0.1,
    duration: 0.2,

  }).progress(1);

  ScrollTrigger.create({
    start: "top top",
    end: 99999,
    onUpdate: (self) => {
      if (self.direction === -1) {

        showAnimli.play();
      } else {

        showAnimli.reverse();
      }
    }
  });



  //

  gsap.registerPlugin(ScrollTrigger);


  var button = document.getElementById("buttonstart");

  var contanimacion = document.querySelector(".cont");
  var irisanimacion = document.querySelector(".iris");

  var irisElement = document.querySelector(".iris");
  var bolaElement = document.querySelector(".bola");

  var avisoScroll = document.querySelector(".avisoScroll");



  button.addEventListener("click",startAnimation);

  function startAnimation() {
 
    let delayedCall;
  ScrollTrigger.create({
    start: "top top",
    end: 99999,

    onUpdate: self => {
      const velocity = self.getVelocity();
      console.log("es" + velocity) ;
      if (velocity > 1) {
        gsap.to('.avisoScroll', { opacity: 0 })
      } else if (velocity < -1) {
        gsap.to('.avisoScroll', { opacity: 0 })
      }
      if (delayedCall)
        delayedCall.kill();
      delayedCall = gsap.delayedCall(1, () => gsap.to('.avisoScroll', { opacity: 1 }));
    }
  });

  
    contanimacion.classList.add("animatecont");
    irisanimacion.classList.add("animateiris");
  }



  var section1 = document.querySelector(".section1");
  var midWidth = Math.floor(section1.offsetWidth / 2);
  var midHeight = Math.floor(section1.offsetHeight / 2);
  var mousePos = {
    x: midWidth,
    y: midHeight
  };

  document.addEventListener("mousemove", updateMousePos);

  function updateMousePos(event) {
    if (section1.contains(event.target)) {
      mousePos.x = event.pageX - section1.offsetLeft;
      mousePos.y = event.pageY - section1.offsetTop;
      var transX = mousePos.x - midWidth;
      var transY = mousePos.y - midHeight;
      var skewX = 0;
      if (transX > -30 && transX < 30 && transY < 0) {
        skewX = transX / 2;
      } else if (transX > -30 && transX < 30 && transY >= 0) {
        skewX = -(transX / 2);
      } else if (transX > 30) {
        skewX = -(transY / 2);
      } else if (transX < -30) {
        skewX = transY / 2;
      }
      if (transX >= 40) {
        transX = 40;
      } else if (transX <= -40) {
        transX = -40;
      }
      if (transY >= 10) {
        transY = 10;
      } else if (transY <= -20) {
        transY = -20;
      }

      if (skewX >= 15) {
        skewX = 15;
      } else if (skewX <= -15) {
        skewX = -15;
      }

      var iris = document.querySelector(".iris");
      iris.style.transform = "translateX(" + transX + "px) translateY(" + transY + "px) skewX(" + skewX + "deg) skewY(2deg)";

      var irisRect = irisElement.getBoundingClientRect();
      var irisTop = irisRect.top + window.scrollY;
      var irisLeft = irisRect.left + window.scrollX;

      bolaElement.style.top = irisTop + 30 + "px";
      bolaElement.style.left = irisLeft + 35 + "px";



    }
  }

  function stopUpdateMousePos() {
    document.removeEventListener("mousemove", updateMousePos);
  }



  var tl



  function enableTimeline() {

    tl = gsap.timeline({
      scrollTrigger: {
        markers: true,
        scrub: 1,
        trigger: ".section1",
        start: "top top",
        end: "40% top",
        invalidateOnRefresh: true,

      }
    })



    /*---TL1---*/
    tl.add(getSection2pos,);

    function getSection2pos() {
      var section2 = document.querySelector(".section2");
      var section2Rect = section2.getBoundingClientRect();
      var section2Top = section2Rect.top + window.scrollY;
      var bolaElement = document.querySelector(".bola");
      var bolaElementRect = bolaElement.getBoundingClientRect();
      var bolaElementBottom = bolaElementRect.bottom + window.scrollY;
      var deltaY = section2Top - bolaElementBottom;
      tl.to(".bola", {
        y: deltaY,
        duration: 20,
        ease: "bounce.out",

      })


        .to(".section2", {
          backgroundColor: "black",
          duration: .005,
          ease: "none",
        }, "<+=7.3");
    }

    tl.to(".int", {
      display: "none",
      duration: 0.005,
    })
      .to(".bola", {
        opacity: 1,
        duration: 0.005,

      })



    tl.to(".section3", {
      height: "100vh",
    },)



    ScrollTrigger.refresh();

    tl.add(tl2)
    tl.add(stopUpdateMousePos);

  }



  const divAncho = document.querySelector(".divAncho");
  /*   console.log(divAncho.offsetWidth) */

  function getScrollAmount() {
    let divAnchoWidth = divAncho.scrollWidth;
    return -(divAnchoWidth - window.innerWidth);

  }
  /*---TL2---*/
  function tl2() {

    const blobWrapper = document.querySelector('.blob-wrapper')
    const numDivs = 15;
    let numDivsPerSecond = 1000;

    let tl2 = gsap.timeline({
      onStart: createDivs,
      scrollTrigger: {
        //    markers: { startColor: "violet", endColor: "violet", fontSize: "18px", fontWeight: "bold", indent: 20 },
        trigger: ".wrapwrapper",
        start: "top top",
        end: () => `+=${getScrollAmount() * -8}`,
        pin: true,
        pinSpacing: true,
        scrub: .1,

      }
    })



    /* 
      tl2.to(".wrapwrapper", {
        scrollTrigger: {
          markers: { startColor: "violet", endColor: "violet", fontSize: "18px", fontWeight: "bold", indent: 20 },
          trigger: ".wrapwrapper",
          start: "top bottom",
          end: " center center",
          once: true,
          onUpdate: createDivs,
    
        }
      }); */
    let i = 0;
    let a = 0;
    let e = 0;
    const timer = ms => new Promise(res => setTimeout(res, ms))
    async function createDivs(self) {


      /* let scrollProgress = self.progress;
      let numDivsPerSecond = Math.floor(scrollProgress * 90) + 1; */

      for (let i = 0; i < 200; i++) {
        /*  console.log("divs creados: " + a++) ; */
        const blob = document.createElement("div");
        blob.classList.add("blob");
        blob.style.left = `${Math.random() * 101}%`;
        blob.style.width = `${Math.random() * 25}%`
        /*      blob.style.width = `${scrollProgress * 5}%`; */
        blob.style.setProperty('--blob-top', `${Math.random() * 70 + 1}%`);
        blob.style.setProperty('--blob-size', `${Math.random() * 10}%`);
        blobWrapper.appendChild(blob);
        await timer(8);
        setTimeout(() => {
          /*  console.log("divs eliminados: " + e++) */
          /*     console.log("fuera") */
          blob.remove()
        }, 10000)

      }



    }



    let sec = `${getScrollAmount() / 1}`;
    /*   console.log("scroll " + getScrollAmount());
    console.log("scroll /3 " + sec)
    */

    tl2.to(".blob-wrapper", {

      opacity: 1,
      duration: 20,

    })
    tl2.to(".blob-wrapper", {
      backgroundColor: "rgb(0, 0, 0)",
      duration: 40,
    },)

      .to(".text--oscuridad", {
        opacity: 0,
        ease: "bounce.out",
        duration: 5,
      })

      .to(".text--oscuridad", {
        filter: "invert(50%)",
        duration: 10,
      })

      .to(".text--oscuridad", {
        filter: "invert(0%)",
        duration: 0,
      })
      .to(".luz", {
        filter: "invert(0%)",
        opacity: 1,
        duration: 1,

      }, "<")
      .to(".text--oscuridad", {
        opacity: 1,
        duration: 8,
      })


      .to(".text--oscuridad", {
        filter: "invert(100%)",
        duration: 0,
      })

      .to(".amarillo", {
        backdropFilter: "sepia(100%)",
        duration: 10,
      })



      .to(".luz", {
        filter: "invert(100%)",
        duration: 0,
      }, "<")
      .to(".luz", {
        backgroundColor: " #f9f9f9",
        boxShadow: "0 0 40px 20px #fff, 0 0 100px 50px #ff0",
      })

      .to(".wrapperText1", {
        opacity: 1,
        duration: 20,
      },)
      .to(".wrapperText2", {
        opacity: 1,
        duration: 20,
      }, "<")
      .to(".wrapperText3", {
        opacity: 1,
        duration: 20,
      }, "<")


      .to(".luz", {
        opacity: 1,
        ease: "bounce.out",
        duration: 10,
      })

      .to(".text--oscuridad", {
        y: 700,
        ease: Elastic.easeOut,
        duration: 10,
      })
      .to(".luz", {
        y: -300,
        duration: 8,
      }, "<")




      .to(".luz", {
        duration: 10,
      },)

      .to(".divAncho", {
        x: -sec,
        duration: 3,
        ease: "none",
      })
      /* .add(function () { console.log('x: ' + sec) }) */
      /* .to(".cosita", {
      rotate: 360*2,
      duration: 3,
      ease: "none",
      }) */


      /* tl2.add(tl3) */
      .to(".cosita1", {
        rotate: 360 * 2,
        duration: 3,
        ease: "none",

      })

      .to(".divAncho", {
        x: "-100vw",
        duration: 10,
        ease: "none",
      })
      .add(function gsamo() {
        let divAnchoWidth = divAncho.scrollWidth;
        let gsamo = divAnchoWidth - window.innerWidth;
        /*   console.log(gsamo) */
      })

      .to(".cosita1", {
        rotate: 360 * 2,
        y: 300,
        duration: 10,
        ease: "none",

      })
      .to(".divAncho", {
        x: "-200vw",

        duration: 10,
        ease: "none",
        delay: 20
      })
      .to(".cosita2", {
        y: 150,
        duration: 10,
        ease: "none",
      })
      .to(".divAncho", {
        x: "-200vw",
        duration: 10,
        ease: "none",
        delay: 20
      })
      .to(".section4", {
        height: "100vh",
      },)

  }

  /* function tl3() {
    let tl3 = gsap.timeline({
      scrollTrigger: {
        markers: true,
        trigger: ".section3b",
        start: "left 70%",
        end: "left 30%",
        containerAnimation: scrollTween,
   
        pin: true,
        pinSpacing: true,
        scrub: .1,
        horizonatal: true,
      }
    })

    .to(".cosita1", {
      rotate: 360 * 2,
      duration: 3,
      ease: "none",

    })

  } */

</script>
</body>

</html>